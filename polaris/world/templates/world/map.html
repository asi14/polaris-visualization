{% load static %}
<!DOCTYPE html>
	<html>
		<head>
			<!-- essentials -->
			<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

			<!-- bootstrap -->
			<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
			<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
			<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

			<style>
			
				#map{
					height:600px;	
					width:auto;
				}
			
			</style>
		</head>
		
		<body>
		
			<div class = "container">
				<div class = "jumbotron text-center">
					<h1>Hello World</h1>
				</div>	

				<div class='progress-wrapper'>
					<div id='progress-bar' class='progress-bar' style="background-color: #68a9ef; width: 0%;">&nbsp;</div>
				</div>
				<div id="progress-bar-message">Waiting for progress to start...</div>

				<div class = "row">
					<div class = "col-md-8">
						<div id = "map"></div>
					</div>
					<div class = "col-md-4">
						<h1>Some Stats</h1>
						<p>Total Duration (Seconds): {{side_values.totalDurationInSeconds}}</p>
						<p>Total Distance (Meters): {{side_values.totalDistanceInMeters}}</p>
						<p>Start Time: {{side_values.startTimestamp|date:"P; l, F j, Y"}}</p>
						<p>End Time: {{side_values.endTimestamp|date:"P; l, F j, Y"}}</p>
						<p style = "display:none" id = "location">Location: </p>
						<div class = "text-center"><button onclick = "location.reload()" type="button" class="btn btn-primary">Generate New Path</button></div>
					</div>
				</div>
				
			</div>

		</body>

		<script>
		
			var map;
			
			var request = new XMLHttpRequest();
			
			request.open('GET','https://maps.googleapis.com/maps/api/geocode/json?latlng={{avg_lat}},{{avg_long}}&key=AIzaSyDAiyVPTvomeKqHRKUWJFNPFZEnb808a_k')

			request.onload = function(){
				var data = JSON.parse(this.response);
				console.log(data['results']['3'])
				if(typeof data['results'][3] !== 'undefined'){
					console.log('b');
					document.getElementById('location').innerHTML = 'Location: ' + data['results'][3]['formatted_address'];	
					document.getElementById('location').style.display = 'block';	
				}
				//data.forEach(datapoint => {
					//console.log(datapoint);	
				//});	
			};

			request.send();

			function initMap() {
				map = new google.maps.Map(document.getElementById('map'), {
					center: {lat: {{avg_lat}}, lng: {{avg_long}}},
					zoom: 16
				});
				var markers = [];
				{% for coord in coords %}
					markers.push(new google.maps.Marker({position:{lat: {{coord.1}}, lng: {{coord.0}}}, map: map}));
				{% endfor %}
				
				var bounds = new google.maps.LatLngBounds();
				for(var i = 0; i < markers.length; i++){
					bounds.extend(markers[i].getPosition());	
				}
				map.fitBounds(bounds);
			}	
		
		</script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzQ6ZjhBNtsK0vpLw62SICuxjP5ca-1dI&callback=initMap"
		    async defer></script>
		<script src="{% static 'celery_progress/celery_progress.js' %}"></script>
		<script>
			var progressUrl = "{% url 'celery_progress:task_status' task_id %}";
			document.addEventListener("DOMContentLoaded", function () {
			  CeleryProgressBar.initProgressBar(progressUrl);
			});
		</script>
	</html>
